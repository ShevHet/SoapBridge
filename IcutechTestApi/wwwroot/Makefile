.PHONY: build minify test clean install

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
install:
	npm install

# –ú–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è CSS
minify-css:
	@echo "üì¶ Minifying CSS..."
	@node -e "const fs=require('fs');const css=fs.readFileSync('styles.css','utf8');fs.writeFileSync('styles.min.css',css.replace(/\/\*[\s\S]*?\*\//g,'').replace(/\s+/g,' ').replace(/\s*([{}:;,])\s*/g,'$$1').replace(/;\s*}/g,'}').trim());"
	@echo "‚úÖ CSS minified"

# –ú–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è JS
minify-js:
	@echo "üì¶ Minifying JS..."
	@node -e "const fs=require('fs');const js=fs.readFileSync('app.js','utf8');fs.writeFileSync('app.min.js',js.replace(/\/\*[\s\S]*?\*\//g,'').replace(/\/\/.*/g,'').replace(/\s+/g,' ').replace(/\s*([{}();,=+\-*/%<>!&|?:])\s*/g,'$$1').trim());"
	@echo "‚úÖ JS minified"

# –ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞
build: minify-css minify-js
	@echo "üöÄ Building production version..."
	@node build.js
	@echo "‚úÖ Build complete!"

# –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
test: build
	@echo "üß™ Running Lighthouse tests..."
	@npm run test:pagespeed || (echo "‚ùå Tests failed" && exit 1)

# Lighthouse —Ç–µ—Å—Ç (—Ç–æ–ª—å–∫–æ)
test-lighthouse:
	@echo "üß™ Running Lighthouse..."
	@npm run test:lighthouse

# –û—á–∏—Å—Ç–∫–∞
clean:
	@echo "üßπ Cleaning build files..."
	@rm -f styles.min.css app.min.js
	@echo "‚úÖ Clean complete"

# –í—Å–µ: —É—Å—Ç–∞–Ω–æ–≤–∫–∞, —Å–±–æ—Ä–∫–∞, —Ç–µ—Å—Ç—ã
all: install build test
	@echo "‚úÖ All done!"

